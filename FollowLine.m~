function [ state ] = FollowLine( state, lineToFollow, time, P )
%FollowLine inputs:
% state of the vehicle at the beginning
% line you wish the vehicle to follow
% the time to follow the line
% the parameters set P
% outputs are:  the state after the time has elapsed.

    v = P.v_const;  %constant velocity of 50 cm/sec
    
    %unpack pose from state
    pose = state(1:3);
    
    %kh = 5;
    
    chi = lineToFollow(3);
    %follow the line lineToFollow for 10 seconds of simulation
    for t = 0:P.delta_t:time
    
        %TODO define the function to set the angular velocity (w) based on
        %distance from the line
        R = [cos(chi), -sin(chi); sin(chi), cos(chi)]';
        l_t = -R * [lineToFollow(1); lineToFollow(2)];
        l_t_w = [R(1,1) R(1,2) l_t(1)...
            R(2,1) R(2,2) l_t(2)...
            0 0 1];
        eyp = (l_t_w * pose);
        ey = eyp(2);
        
        pose = propagatePose(pose, v, w, P.delta_t);
        state = [pose; v; w; state(6)+P.delta_t];
        drawCar(state, P);

    end
end

